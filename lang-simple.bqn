
#####################
# Constants #
nlâ†10+@
varChars â† â¥Š"aA"+âŒœâ†•26

Debug â† âŠ¢ #â€¢Out
AddToken â† {ğ•¨ğ•Šrules: charâ†ğ•¨âŠ£""
  tokensâˆ¾â†©<charâˆ¾ËœrecentToken
  recentTokenâ†©""
  rulesAtTokensâˆ¾â†©<ğ•©
  Debug "Token done"
}
AddPastToken â† {rulesğ•Šchar:
  tokensâˆ¾â†©<recentToken
  recentTokenâ†©âŸ¨ğ•©âŸ©
  rulesAtTokensâˆ¾â†©<ğ•¨
  Debug "Token done"
}
ClearToken â† {ğ•Š@:
  recentTokenâ†©""
}
NewToken â† {ğ•Šchar:
  recentTokenâ†©âŸ¨ğ•©âŸ©
}
#####################

#####################
# Mutable variables #
tokens â† âŸ¨âŸ© # tokens â† each character in string doesn't change the rules `allâ‰¡âˆ¾Â´tokens`
rulesAtTokens â† âŸ¨âŸ© # each token has rules that apply to all chars in it
recentToken â† ""
#####################

#â”œâ”¤â”´â”¬â”€â”‚â”Œâ”â””â”˜â”¼
last â† {
# â”ŒisText
# â”‚ â”ŒisComment
# â”‚ â”‚ â”ŒisVar
# â”‚ â”‚ â”‚
# â”‚ â”‚ â”‚ â”ŒNesting depth
 ğ•Š0â€¿0â€¿0â€¿0:
  0â€¿0â€¿0â€¿0
;ğ•Š0â€¿1â€¿0â€¿0: ğ•¨AddPastTokenğ•© â‹„ Debug "Comment ended"
  0â€¿0â€¿0â€¿0
;ğ•Š1â€¿0â€¿0â€¿0: !"String ended at end-of-file"
;ğ•Š0â€¿0â€¿1â€¿0: !"Var ended at end-of-file"
;ğ•Š0â€¿0â€¿0â€¿n: 0â‰ n? !"Ended at non-zero nesting"
} 0â€¿0â€¿0â€¿0 { # default
  0â€¿0â€¿0â€¿nğ•Š'"': ClearToken@ â‹„ Debug "str begin"
  1â€¿0â€¿0â€¿n
; 1â€¿0â€¿0â€¿nğ•Š'"': AddTokenğ•¨ â‹„ Debug "str end"
  0â€¿0â€¿0â€¿n
; 0â€¿0â€¿0â€¿nğ•Š'#': ClearToken@ â‹„ Debug "Comment begin"
  0â€¿1â€¿0â€¿n
; 0â€¿1â€¿0â€¿nğ•Š'â‹„': ğ•¨AddPastTokenğ•© â‹„ Debug "Comment end"
  0â€¿0â€¿0â€¿n
; 0â€¿0â€¿0â€¿nğ•Š'[': ClearToken@ â‹„ câ†n+1 â‹„ Debug "Bracket begin"
  0â€¿0â€¿0â€¿c
; 0â€¿0â€¿0â€¿cğ•Š']': "Too many ending brackets"!0<c â‹„ nâ†c-1 â‹„ Debug "Bracket end"
  0â€¿0â€¿0â€¿n AddTokenâŠ¸âŠ¢âˆ˜âŠ£@
; 0â€¿0â€¿0â€¿nğ•Šğ•©: âŠ‘ğ•©âˆŠvarChars? NewTokenğ•© â‹„ Debug "Var begin"
  0â€¿0â€¿1â€¿n
; 0â€¿0â€¿1â€¿nğ•Šğ•©: Â¬âŠ‘ğ•©âˆŠvarChars? ğ•©AddTokenğ•¨ â‹„ Debug "Var end"
  0â€¿0â€¿0â€¿n
; recentTokenâˆ¾â†©ğ•© â‹„ ğ•¨
}ËœÂ´âŒ½ {'â‹„'Â¨âŒ¾((nl=ğ•©)âŠ¸/)ğ•©} "ab_ â† ""cd "" ef_
  # hello ""
  [ ""hii"" ]
  [""boo""]
  [""hi""[[ ""hii"" ]""aa""]]
"

# â€¢Out "[["
# â€¢OutÂ¨"  "âŠ¸âˆ¾Â¨(â€¢ReprÂ¨rulesAtTokens)âˆ¾ËœÂ¨(' 'â¥ŠËœÂ¨5+â‰ Â¨-ËœÂ·âŒˆÂ´â‰ Â¨)âŠ¸(âˆ¾Â¨Ëœ)tokens
# â€¢Out "]]"

# [[
#   ab_          0â€¿0â€¿1â€¿0
#   cd           1â€¿0â€¿0â€¿0
#   ef_          0â€¿0â€¿1â€¿0
#    hello "     0â€¿1â€¿0â€¿0
#   hii          1â€¿0â€¿0â€¿1
#                0â€¿0â€¿0â€¿0
#   boo          1â€¿0â€¿0â€¿1
#                0â€¿0â€¿0â€¿0
#   hi           1â€¿0â€¿0â€¿1
#   hii          1â€¿0â€¿0â€¿3
#                0â€¿0â€¿0â€¿2
#   aa           1â€¿0â€¿0â€¿2
#                0â€¿0â€¿0â€¿1
#                0â€¿0â€¿0â€¿0
# ]]

str â† 0âŠ‘Â¨rulesAtTokens
comment â† 1âŠ‘Â¨rulesAtTokens
var â† 2âŠ‘Â¨rulesAtTokens
nesting â† 3âŠ‘Â¨rulesAtTokens
brackets â† Â»âŠ¸>nesting
literals â† âˆ¨Â´âŸ¨strâ‹„varâ‹„bracketsâŸ©
2
â€¢Show literals/nesting
â€¢Show (literals/nesting)âŠ”Ëœ+`literals/brackets
â€¢Show âŸ¨âŸ©Â¨/brackets